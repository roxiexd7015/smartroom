<!--  1. HEAD – încarci Bootstrap și setezi stilul de bază -->
<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SmartRoom Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <!-- Bootstrap pentru stil rapid -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

</head>

<!--  2. BODY – conținutul vizibil în pagină -->
<body>
  {% include 'header.html' %}
  <!--  3. Container cu carduri pentru senzori -->
  <div class="row" id="cards">
    <!-- Card Temperatură -->
    <div class="col-md-3">
      <div class="card p-3" onclick="window.location.href='/details/temperature'">
        <h5>🌡 Temperatură</h5>
        <p id="temp">--</p>
      </div>
    </div>

    <!-- Card Umiditate -->
    <div class="col-md-3">
      <div class="card p-3" onclick="window.location.href='/details/humidity'">
        <h5>💧 Umiditate</h5>
        <p id="hum">--</p>
      </div>
    </div>

    <!-- Card Praf -->
    <div class="col-md-3">
      <div class="card p-3" onclick="window.location.href='/details/dust'">
        <h5>🌫 Praf</h5>
        <p id="dust">--</p>
      </div>
    </div>

    <!-- Card Gaz -->
    <div class="col-md-3">
      <div class="card p-3" onclick="window.location.href='/details/gas'">
        <h5>🧪 Gaz</h5>
        <p id="gas">--</p>
      </div>
    </div>

    <div class="comfort-score mt-5" id="comfortScoreContainer">
      Scor confort: <span id="scoreValue">{{ data.comfort_score }}</span> / 10 <span id="scoreEmoji">🙂</span>
      <div class="comfort-bar mt-2">
        <div id="scoreBar" class="comfort-fill" style="width:84%; background-color:#ce93d8;"></div>
      </div>
    </div>
  </div>

  <script>
    // Exemplu dinamic (poate fi înlocuit cu valoare din Flask)
    const score = parseFloat("{{ data.comfort_score }}");
    const bar = document.getElementById('scoreBar');
    const emoji = document.getElementById('scoreEmoji');

    if (score >= 8) {
      bar.style.backgroundColor = '#66bb6a'; // verde
      emoji.textContent = '😍';
    } else if (score >= 6) {
      bar.style.backgroundColor = '#ffee58'; // galben
      emoji.textContent = '🙂';
    } else if (score >= 4) {
      bar.style.backgroundColor = '#ffa726'; // portocaliu
      emoji.textContent = '😐';
    } else {
      bar.style.backgroundColor = '#ef5350'; // roșu
      emoji.textContent = '😟';
    }

    bar.style.width = (score * 10) + '%';
  </script>

  <!--  Actualizare automată din API la fiecare 5 secunde -->
  <script>
    async function fetchLatestData() {
      const res = await fetch('/api/latest');
      const data = await res.json();
      const latest = data[0];
      if (!latest) return;

      document.querySelector('#temp').innerText = latest.temperature + ' °C';
      document.querySelector('#hum').innerText = latest.humidity + ' %';
      document.querySelector('#dust').innerText = latest.dust + ' µg/m³';
      document.querySelector('#gas').innerText = latest.gas + ' kΩ';
      document.querySelector('#scoreValue').innerText = latest.comfort_score;

      const score = parseFloat(latest.comfort_score);
      const bar = document.getElementById('scoreBar');
      const emoji = document.getElementById('scoreEmoji');

      if (score >= 8) {
        bar.style.backgroundColor = '#66bb6a'; emoji.textContent = '😍';
      } else if (score >= 6) {
        bar.style.backgroundColor = '#ffee58'; emoji.textContent = '🙂';
      } else if (score >= 4) {
        bar.style.backgroundColor = '#ffa726'; emoji.textContent = '😐';
      } else {
        bar.style.backgroundColor = '#ef5350'; emoji.textContent = '😟';
      }
      bar.style.width = (score * 10) + '%';
    }

    fetchLatestData();
    setInterval(fetchLatestData, 5000);
    
  </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
